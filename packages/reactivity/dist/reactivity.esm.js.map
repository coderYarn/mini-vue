{
  "version": 3,
  "sources": ["../src/effect.ts", "../../shared/src/index.ts", "../src/reactive.ts", "../src/ref.ts", "../src/computed.ts"],
  "sourcesContent": ["const effectStack = [];\r\nlet activeEffect;\r\n\r\nexport function effect(fn, option = {}) {\r\n  const effectFn = () => {\r\n    try {\r\n      effectStack.push(effectFn);\r\n      activeEffect = effectFn;\r\n      return fn();\r\n    } finally {\r\n      effectStack.pop();\r\n      activeEffect = effectStack[effectStack.length - 1];\r\n    }\r\n  };\r\n  if (!option.lazy) {\r\n    effectFn();\r\n  }\r\n  effectFn.scheduler = option.scheduler;\r\n  return effectFn;\r\n}\r\n\r\nconst targetMap = new WeakMap();\r\n\r\nexport function track(target, key) {\r\n  if (!activeEffect) {\r\n    return;\r\n  }\r\n  let depsMap = targetMap.get(target);\r\n  if (!depsMap) {\r\n    targetMap.set(target, (depsMap = new Map()));\r\n  }\r\n  let dep = depsMap.get(key);\r\n  if (!dep) {\r\n    depsMap.set(key, (dep = new Set()));\r\n  }\r\n  dep.add(activeEffect);\r\n}\r\n\r\nexport function trigger(target, key) {\r\n  const depsMap = targetMap.get(target);\r\n  if (!depsMap) {\r\n    return;\r\n  }\r\n  const dep = depsMap.get(key);\r\n  if (!dep) {\r\n    return;\r\n  }\r\n  dep.forEach((effectFn) => {\r\n    if (effectFn.scheduler) {\r\n      effectFn.scheduler(effectFn);\r\n    } else {\r\n      effectFn();\r\n    }\r\n  });\r\n}\r\n", "export function isObject(value) {\r\n  return typeof value === 'object' && value !== null;\r\n}\r\n\r\nexport function isFunction(value) {\r\n  return typeof value === 'function';\r\n}\r\n\r\nexport function isArray(value) {\r\n  return Array.isArray(value);\r\n}\r\n\r\nexport function isString(value) {\r\n  return typeof value === 'string';\r\n}\r\n\r\nexport function isNumber(value) {\r\n  return typeof value === 'number';\r\n}\r\n\r\nexport function hasChanged(value, oldValue) {\r\n  return value !== oldValue && (value === value || oldValue === oldValue);\r\n}\r\n\r\nconst camelizeRE = /-(\\w)/g;\r\nexport function camelize(str) {\r\n  return str.replace(camelizeRE, (_, c) => (c ? c.toUpperCase() : ''));\r\n}\r\n\r\nexport function capitalize(str) {\r\n  return str[0].toUpperCase() + str.slice(1);\r\n}", "import { isObject, hasChanged, isArray } from '../../shared/src';\r\nimport { track, trigger } from './effect';\r\n\r\nconst reactiveMap = new WeakMap();\r\n\r\nexport function reactive(target) {\r\n  if (!isObject(target)) {\r\n    return target;\r\n  }\r\n  if (isReactive(target)) {\r\n    return target;\r\n  }\r\n  if (reactiveMap.has(target)) {\r\n    return reactiveMap.get(target);\r\n  }\r\n  const proxy = new Proxy(target, {\r\n    get(target, key, receiver) {\r\n      if (key === '__isReactive') {\r\n        return true;\r\n      }\r\n      track(target, key);\r\n      const res = Reflect.get(target, key, receiver);\r\n      return isObject(res) ? reactive(res) : res;\r\n    },\r\n    set(target, key, value, receiver) {\r\n      const oldValue = target[key];\r\n      const oldLength = target.length;\r\n      const res = Reflect.set(target, key, value, receiver);\r\n      if (hasChanged(value, oldValue)) {\r\n        trigger(target, key);\r\n        if (isArray(target) && target.length !== oldLength) {\r\n          trigger(target, 'length');\r\n        }\r\n      }\r\n      return res;\r\n    },\r\n  });\r\n  reactiveMap.set(target, proxy);\r\n  return proxy;\r\n}\r\n\r\nexport function isReactive(target) {\r\n  return !!(target && target.__isReactive);\r\n}\r\n", "import { hasChanged, isObject } from '../../shared/src';\r\nimport { track, trigger } from './effect';\r\nimport { reactive } from './reactive';\r\n\r\nexport function ref(value) {\r\n  if (isRef(value)) {\r\n    return value;\r\n  }\r\n  return new RefImpl(value);\r\n}\r\n\r\nexport function isRef(value) {\r\n  return !!(value && value.__isRef);\r\n}\r\n\r\nclass RefImpl {\r\n  constructor(value) {\r\n    this.__isRef = true;\r\n    this._value = convert(value);\r\n  }\r\n\r\n  get value() {\r\n    track(this, 'value');\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    if (hasChanged(val, this._value)) {\r\n      this._value = convert(val);\r\n      trigger(this, 'value');\r\n    }\r\n  }\r\n}\r\n\r\nfunction convert(value) {\r\n  return isObject(value) ? reactive(value) : value;\r\n}\r\n", "import { isFunction } from '../../shared/src';\r\nimport { track, trigger, effect } from './effect';\r\n\r\nexport function computed(getterOrOptions) {\r\n  let getter, setter;\r\n  if (isFunction(getterOrOptions)) {\r\n    getter = getterOrOptions;\r\n    setter = () => {\r\n      console.warn('Write operation failed: computed value is readonly');\r\n    };\r\n  } else {\r\n    getter = getterOrOptions.get;\r\n    setter = getterOrOptions.set;\r\n  }\r\n\r\n  return new ComputedRefImpl(getter, setter);\r\n}\r\n\r\nclass ComputedRefImpl {\r\n  constructor(getter, setter) {\r\n    this._setter = setter;\r\n    this._value = undefined;\r\n    this._dirty = true;\r\n    this.effect = effect(getter, {\r\n      lazy: true,\r\n      scheduler: () => {\r\n        if (!this._dirty) {\r\n          this._dirty = true;\r\n          trigger(this, 'value');\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  get value() {\r\n    if (this._dirty) {\r\n      this._value = this.effect();\r\n      this._dirty = false;\r\n      track(this, 'value');\r\n    }\r\n    return this._value;\r\n  }\r\n\r\n  set value(val) {\r\n    this._setter(val);\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
